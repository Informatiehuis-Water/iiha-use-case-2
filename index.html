<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">
    <title>Inzicht in het Achterland: Ruimtelijke Adaptatie</title>

    <!--add Leaflet CSS-->
    <link rel="stylesheet" href="style.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
        integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin="" />

        <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

    <!--our own style rules-->

    <style type="text/css">
        html {
            height: 100vh;
        }

        body {
            min-height: 100vh;
        }

        #map-container {
            min-height: calc(100vh - 100px);
            height: calc(100vh - 100px);
        }
    </style>

    <link rel="stylesheet" href="./leaflet-sidebar/L.Control.Sidebar.css" />


</head>

<body>

    <div id="header">
        <h1 id=site-title>Inzicht in het Achterland<span id="page-title">Ruimtelijke Adaptatie</span></h1>
    </div>
    <div class="parent">
        <div class="child map">
            <div id="left-sidebar">
                <h1>Ruimtelijke plannen</h1>

                <!-- <div class="outer-parent">

                    <div class="inner-child">
                        <div class="item-left"></div>
                        <div class="item-middle"></div>
                        <div class="item-right"></div>
                    </div>
                </div> -->

                <button class = "ruimtelijkplan" onclick="polySelect('NL.IMRO.0530.BPKickersbloem2012-vo01')">
                    <p><b>Naam:</b> Bedrijventerrein Kickersbloem 3<br>
                    <b>Overheid: </b> Hellevoetsluis<br>
                    <b>Identificatie:</b> NL.IMRO.0530.BPKickersbloem2012-vo01</p>
                </button>
                <br>
                <button class = "ruimtelijkplan" onclick="polySelect('NL.IMRO.0530.BPBuitengebied2011-vo01')">
                    <p><b>Naam:</b> Buitengebied Hellevoetsluit<br>
                    <b>Overheid: </b> Gemeente Hellevoetsluis<br>
                    <b>Identificatie:</b> NL.IMRO.0530.BPBuitengebied2011-vo01</p>
                </button>
                <br>
                <button class = "ruimtelijkplan" onclick="polySelect('NL.IMRO.0530.BPRavenseHoek2011-VO01')">
                    <p><b>Naam:</b> Ravensehoek<br>
                    <b>Overheid:</b> Gemeente Hellevoetsluis<br>
                    <b>Identificatie:</b> NL.IMRO.0530.BPRavenseHoek2011-VO01</p>
                </button>
                <br>
                <button class = "ruimtelijkplan" onclick="polySelect('NL.IMRO.0530.BPDeVesting2011-ON01')">
                    <p><b>Naam:</b> De Vesting<br>
                    <b>Overheid:</b> Gemeente Hellevoetsluis<br>
                    <b>Identificatie:</b> NL.IMRO.0530.BPDeVesting2011-ON01</p>
                </button>
                <br>
                <button class = "ruimtelijkplan" onclick="polySelect('NL.IMRO.0530.BPNieuwenhoorn2011-VO01')">
                    <p><b>Naam:</b> Nieuwenhoorn<br>
                    <b>Overheid:</b> Gemeente Hellevoetsluis<br>
                    <b>Identificatie:</b>NL.IMRO.0530.BPNieuwenhoorn2011-VO01</p>
                </button>
                <br>
                <button class = "ruimtelijkplan" onclick="polySelect('NL.IMRO.0530.BPRecreatie2011-ON01')">
                    <p><b>Naam:</b> Recreatie<br>
                    <b>Overheid: </b> Gemeente Hellevoetsluis<br>
                    <b>Identificatie:</b> NL.IMRO.0530.BPRecreatie2011-ON01</p>
                </button>
                <br>
                <button class = "ruimtelijkplan" onclick="polySelect('NL.IMRO.0530.BPKooistee2009-vo01')">
                    <p><b>Naam:</b> De Kooistee<br>
                    <b>Overheid:</b> Gemeente Hellevoetsluis<br>
                    <b>Identificatie:</b> NL.IMRO.0530.BPKooistee2009-vo01</p>
                </button>
                <br>
                <button class = "ruimtelijkplan" onclick="polySelect('NL.IMRO.0530.BP30Molshoek2010-ow01')">
                    <p><b>Naam:</b> Molshoek<br>
                    <b>Overheid:</b> Gemeente Hellevoetsluis<br>
                    <b>Identificatie:</b> NL.IMRO.0530.BP30Molshoek2010-ow01</p>
                </button>
                <br>
                <button class = "ruimtelijkplan" onclick="polySelect('NL.IMRO.0614.1209bpHoofdwg2017-0010')">
                    <p><b>Naam:</b> Hoofdweg Oostvoorne 2017<br>
                    <b>Overheid:</b> Gemeente Westvoorne<br>
                    <b>Identificatie:</b> NL.IMRO.0614.1209bpHoofdwg2017-0010</p>
                </button>
            </div>
            <div id="right-sidebar">
                <h1 class='attribute_group_title'>Planinformatie</h1>
                    <p class='attribute_title'>Identicatie</p>
                    <p id='identificatie'></p>
                    <p class='attribute_title'>Naam</p>
                    <p id='naam'></p>
                    <p class='attribute_title'>Datum</p>
                    <p id='datum'></p>
                    <p class='attribute_title'>Verwijzing</p>
                    <p id='verwijzing'></p>
                    <p class='attribute_title'>Type plan</p>
                    <p id='type_plan'></p>
                    <p class='attribute_title'>Planstatus</p>
                    <p id='plan_status'></p>
                    <p class='attribute_title'>Naam overheid</p>
                    <p id='naam_overheid'></p>
                <h1 class='attribute_group_title'>Overstromingsinformatie</h1>
                <p class='attribute_title'>Maximale waterdiepte (meter)</p> 
                <input id="wms" type="checkbox" onclick="layerControl();">
                <label for="wms"> Toon op kaart</label><br>
                <p id='maximale_waterdiepte'></p>
                <p class='attribute_title'>Maximale plaatsgebonden overstromingskans</p>
                <p id='maximale_plaatsgebonden_overstromingskans'></p>
                <p class='attribute_title'>Stijgsnelheid</p>
                <p id='stijgsnelheid'></p>
                <p class='attribute_title'>Aankomsttijd</p>
                <p id='aankomsttijd'></p>
                <p class='attribute_title'>Stroomsnelheid</p>
                <p id='stroomsnelheid'></p>
            </div> 
            <div id="map-container"></div>
        </div>
        <!-- <div class="child right">
            <div class="sidebar">
                <h2 class='attribute_group_title'>Planinformatie</h2>
                    <p class='attribute_title'>Identicatie</p>
                    <p id='identificatie'></p>
                    <p class='attribute_title'>Naam</p>
                    <p id='naam'></p>
                    <p class='attribute_title'>Datum</p>
                    <p id='datum'></p>
                    <p class='attribute_title'>Verwijzing</p>
                    <p id='verwijzing'></p>
                    <p class='attribute_title'>Type plan</p>
                    <p id='type_plan'></p>
                    <p class='attribute_title'>Planstatus</p>
                    <p id='plan_status'></p>
                    <p class='attribute_title'>Naam overheid</p>
                    <p id='naam_overheid'></p>
                <h2 class='attribute_group_title'>Overstromingsinformatie</h2>
                <p class='attribute_title'>Maximale waterdiepte (meter)</p>
                <p id='maximale_waterdiepte'></p>
                <p class='attribute_title'>Maximale plaatsgebonden overstromingskans</p>
                <p id='maximale_plaatsgebonden_overstromingskans'></p>
                <p class='attribute_title'>Stijgsnelheid</p>
                <p id='stijgsnelheid'></p>
                <p class='attribute_title'>Aankomsttijd</p>
                <p id='aankomsttijd'></p>
                <p class='attribute_title'>Stroomsnelheid</p>
                <p id='stroomsnelheid'></p>       

            </div>
        </div> -->


        <!--load leaflet.js-->

        <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
            integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
            crossorigin=""></script

        <!--code we need to use a different projection-->

        <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.4/proj4.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.min.js"></script>

        <script src="./leaflet-sidebar/L.Control.Sidebar.js"></script>



        <!--our own code to create the map-->

        <script>

         

            //define the custom projection tileset (Amersfoort/RD)

            var RD = new L.Proj.CRS('EPSG:28992', '+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +towgs84=565.2369,50.0087,465.658,-0.406857330322398,0.350732676542563,-1.8703473836068,4.0812 +no_defs', {
                resolutions: [3440.640, 1720.320, 860.160, 430.080, 215.040, 107.520, 53.760, 26.880, 13.440, 6.720, 3.360, 1.680, 0.840, 0.420, 0.210],
                bounds: L.bounds([-285401.92, 22598.08], [595401.9199999999, 903401.9199999999]),
                origin: [-285401.92, 22598.08]

            }

            );

            //initialize the map with our coordinate reference system

            let map = L.map('map-container', {
                crs: RD
            });

            //map view still gets set with Latitude/Longitude,

            //but the zoomlevel is now different (it uses the resolutions defined in our projection tileset above)

            map.setView([51.838, 4.150], 8);

            //add background layer in custom projection

            let bglayer_BRTAchtergrondkaart = new L.TileLayer('http://geodata.nationaalgeoregister.nl/tiles/service/tms/1.0.0/brtachtergrondkaartwater/EPSG:28992/{z}/{x}/{y}.png', {
                minZoom: 0,
                maxZoom: 13,
                tms: true,
                attribution: 'Map data: <a href="http://www.kadaster.nl">Kadaster</a>'

            });

            bglayer_BRTAchtergrondkaart.addTo(map)

            let layer_dijktrajecten = new L.TileLayer.WMS('https://waterveiligheidsportaal.nl/geoserver/spa/ows?', {
                layers: 'nbpw',
                transparent: true,
                format: 'image/png'
            }).addTo(map);

            let wmsLayer = new L.TileLayer.WMS('https://nens.lizard.net/wms/raster_bcbc32a5-8602-4cac-b3b1-51fc7eabc435/?', {
                layers: 'nelen-schuurmans:plaatsgebonden_overstroming_primaire_k-4wstxb9z',
                transparent: true,
                format: 'image/png'
            });

            // let layer_ruimtelijkeplannen = new L.TileLayer.WMS('https://maps1.project.lizard.net/geoserver/p_iiha_lizard/wfs', {
            //     layers: 'p_iiha_lizard:v0101_iiha_ruimte_plannen_dkr20_01012021',
            //     transparent: true,
            //     format: 'image/png'
            // }).addTo(map);

            // let layer_ruimtelijkeplannen = new L.TileLayer.WFS('https://maps1.project.lizard.net/geoserver/p_iiha_lizard/wfs', {
            //     layers: 'p_iiha_lizard:v0101_iiha_ruimte_plannen_dkr20_01012021',
            //     transparent: true,
            //     format: 'image/png'
            // }).addTo(map);

            function highlightFeature(e) {
                var layer = e.target;
                layer.setStyle({
                    weight: 2,
                    color: '#333',
                });
                if (!L.Browser.ie && !L.Browser.opera) {
                    layer.bringToFront();
                }
            }

            function resetHighlight(e) {
                geojson.resetStyle(e.target);
            }

            function zoomToFeature(e) {
                map.fitBounds(e.target.getBounds());
            }

            function displayAttributes(e) {
                var datum = document.getElementById('datum');
                datum.innerHTML = e.target.feature.properties.datum;
                var identificatie = document.getElementById('identificatie');
                identificatie.innerHTML = e.target.feature.properties.identifica;
                var naam = document.getElementById('naam');
                naam.innerHTML = e.target.feature.properties.naam;
                // var field4 = document.getElementById('f4');
                // field4.innerHTML = e.target.feature.properties.beleidsmve;
                var naam_overheid = document.getElementById('naam_overheid');
                naam_overheid.innerHTML = e.target.feature.properties.naamoverhe;
                var planstatus = document.getElementById('plan_status');
                planstatus.innerHTML = e.target.feature.properties.planstatus;
                var type_plan = document.getElementById('type_plan');
                type_plan.innerHTML = e.target.feature.properties.typeplan;
                var verwijzing = document.getElementById('verwijzing');
                verwijzing.innerHTML = e.target.feature.properties.verwijzing;
                var max_plaatsgebonden_overstromingskans = document.getElementById('maximale_plaatsgebonden_overstromingskans');
                max_plaatsgebonden_overstromingskans.innerHTML = e.target.feature.properties.maximalepl + ": " + e.target.feature.properties.beschrijvi;
                console.log(e.target.feature.properties)
                // var field10 = document.getElementById('f10');
                // field10.innerHTML = e.target.feature.properties.beschrijvi;
                var maximale_waterdiepte = document.getElementById('maximale_waterdiepte');
                maximale_waterdiepte.innerHTML = Math.round((e.target.feature.properties.maximalewa + Number.EPSILON) * 100) / 100;
                var stijgsnelheid = document.getElementById('stijgsnelheid');
                // stijgsnelheid.innerHTML = e.target.feature.properties.stijgsnelh;
                stijgsnelheid.innerHTML = "Binnenkort beschikbaar"
                var aankomsttijd = document.getElementById('aankomsttijd');
                // aankomsttijd.innerHTML = e.target.feature.properties.aankomstij;
                aankomsttijd.innerHTML = "Binnenkort beschikbaar"
                var stroomsnelheid = document.getElementById('stroomsnelheid'); 
                // stroomsnelheid.innerHTML = e.target.feature.properties.stroomsnel;
                stroomsnelheid.innerHTML = "Binnenkort beschikbaar"
                


                // var field12 = document.getElementById('f12');
                // field12.innerHTML = e.target.feature.properties.scenarios;
                // var field13 = document.getElementById('maximale_waterdieptes');
                // field13.innerHTML = e.target.feature.properties.maximale_1;
                // var field14 = document.getElementById('f14');
                // field14.innerHTML = e.target.feature.properties.uuids;
                // var field15 = document.getElementById('f15');
                // field15.innerHTML = e.target.feature.properties.traject_id;
                // var field16 = document.getElementById('f16');
                // field16.innerHTML = e.target.feature.properties.norm_sign;
                // var field17 = document.getElementById('f17');
                // field17.innerHTML = e.target.feature.properties.norm_onder;
            }

            function selectFeature(e) {
                rightsidebar.show();
                map.eachLayer(function(layer) {
    if(layer.options.pane === "tooltipPane") layer.removeFrom(map);
});
                zoomToFeature(e);
                displayAttributes(e);
                
            }

            function onEachFeature(feature, layer) {
                layer._leaflet_id = feature.properties.identifica;
                layer.on({
                    mouseover: highlightFeature,
                    mouseout: resetHighlight,
                    click: selectFeature
                });
                layer.bindTooltip(feature.properties.naam);
            }

            var geojson = L.geoJson(null,
                {
                    style: getStyle,
                    onEachFeature: onEachFeature
                }
            ).addTo(map);

            var url = 'https://maps1.project.lizard.net/geoserver/p_iiha_lizard/wfs?';

            // These parameters are identical for all GeoJSON-requests:
            var params = 'service=WFS&version=2.0.0&request=GetFeature&outputFormat=application/json&srsName=EPSG:4326&';

            // These parameters have to be modified per GeoJSON-request
            params += 'typeName=p_iiha_lizard:v0101_iiha_ruimte_plannen_dkr20_01012021&';

            // Ajax without jQuery ;-)
            var xhr = new XMLHttpRequest();
            xhr.open('GET', encodeURI(url + params));
            xhr.onload = function () {
                if (xhr.status === 200) {
                    geojson.addData(JSON.parse(xhr.responseText));
                } else {
                    alert('Request failed.  Returned status of ' + xhr.status);
                }
            };
            xhr.send();


            function getStyle(features) {
                var status = features.properties.planstatus;
                return {
                    color: '#fff',
                    fillColor: getColour(status),
                    weight: 0.8,
                    opacity: 1,
                    fillOpacity: 0.6
                }
            }  

            function getColour(d) {
                var colour;
                if (d == "concept") {
                    colour = '#ffd2a2'
                } else if (d == "voorontwerp") {
                    colour = '#ffad5f'
                } else {
                    colour = '#ff8535'
                }
                return colour;
            }

            

// fire off click event and zoom to polygon  
function polySelect(a){
        map._layers[a].fire('viewreset')
        map._layers[a].fire('click');  // 'clicks' on state name from search
}

var legend = L.control({position: 'bottomright'})

var planstatus;

legend.onAdd = function (map) {
	var div = L.DomUtil.create('div', 'info legend');
	planstatus = ['concept', 'voorontwerp', 'ontwerp'];
		
	// loop through the status values and generate a label with a coloured square for each value
	for (var i = 0; i < planstatus.length; i++) {
		div.innerHTML +=
			'<i class="square" style="background:' + getColour(planstatus[i]) + '"></i> ' + (planstatus[i] ? planstatus[i] + '<br>' : '+');
	}
	return div;
};
legend.addTo(map);

var leftsidebar = L.control.sidebar('left-sidebar', {
            closeButton: true,
            position: 'left'
        });
        map.addControl(leftsidebar);

        setTimeout(function () {
            leftsidebar.show();
        }, 500);

        var rightsidebar = L.control.sidebar('right-sidebar', {
            closeButton: true,
            position: 'right'
        });
        map.addControl(rightsidebar);

        L.DomEvent.on(leftsidebar.getCloseButton(), 'click', function () {
            console.log('Close button clicked.');
        });

        // map.on('click', function () {
        //     rightsidebar.toggle();
        // })

        function layerControl() {
                var checkBox = document.getElementById("wms");
                  // If the checkbox is checked, display the output text
  if (checkBox.checked == true){
    wmsLayer.addTo(map)
    geojson.setStyle(
        {fillOpacity : 0,
        color: "black"}
    )
  } else {
    wmsLayer.removeFrom(map)
    geojson.setStyle(
        {fillOpacity : 0.6,
            color: "white"}
    )
  }
}   

        </script>

</body>

</html>